# データベースの構築
初めにデータベースの構築をします。  
MySQL等のDBMSにログインし、次のコードを書きます。
```sql
create database internet_tv;
```
次に使用するデータベースを選択します。
```sql
use internet_tv;
```

# テーブルの構築
ステップ1で設計したテーブルを依存関係の順番で作成していきます。
## チャンネルテーブル
```sql
CREATE TABLE channels (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(100) NOT NULL
);
```

## 番組テーブル
```sql
CREATE TABLE programs (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
title VARCHAR(255) NOT NULL,
description TEXT,
is_series BOOLEAN NOT NULL DEFAULT 0
);
```

## ジャンルテーブル
```sql
CREATE TABLE genres (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(100) NOT NULL UNIQUE
);
```

## 番組とジャンルの中間テーブル
```sql
CREATE TABLE program_genres (
program_id BIGINT NOT NULL,
genre_id BIGINT NOT NULL,
PRIMARY KEY (program_id, genre_id),
FOREIGN KEY (program_id) REFERENCES programs(id),
FOREIGN KEY (genre_id) REFERENCES genres(id)
);
```

## シーズンテーブル
```sql
CREATE TABLE seasons (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_id BIGINT NOT NULL,
season_number INT NOT NULL,
UNIQUE (program_id, season_number),
FOREIGN KEY (program_id) REFERENCES programs(id)
);
```

## エピソードテーブル
```sql
CREATE TABLE episodes (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_id BIGINT NOT NULL,
season_id BIGINT,
episode_number INT,
title VARCHAR(255) NOT NULL,
description TEXT,
duration_seconds INT NOT NULL,
published_at DATETIME NOT NULL,
FOREIGN KEY (program_id) REFERENCES programs(id),
FOREIGN KEY (season_id) REFERENCES seasons(id)
);
```

## 番組枠テーブル
```sql
CREATE TABLE program_slots (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
channel_id BIGINT NOT NULL,
start_time DATETIME NOT NULL,
end_time DATETIME NOT NULL,
FOREIGN KEY (channel_id) REFERENCES channels(id)
);
```

## 放送テーブル（番組枠 × エピソード）
```sql
CREATE TABLE broadcasts (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_slot_id BIGINT NOT NULL,
episode_id BIGINT NOT NULL,
FOREIGN KEY (program_slot_id) REFERENCES program_slots(id),
FOREIGN KEY (episode_id) REFERENCES episodes(id)
);
```

## 視聴数-KPIテーブル
```sql
CREATE TABLE episode_views (
broadcast_id BIGINT PRIMARY KEY,
view_count BIGINT NOT NULL,
FOREIGN KEY (broadcast_id) REFERENCES broadcasts(id)
);
```
# サンプルデータ
サンプルデータを投入します。
## チャンネル
```sql
INSERT INTO channels (name) VALUES
('ドラマ1'),
('ドラマ2'),
('アニメ1'),
('アニメ2'),
('スポーツ'),
('ペット');
```

## ジャンル
```sql
INSERT INTO genres (name) VALUES
('アニメ'),
('ドラマ'),
('映画'),
('ニュース');
```

## 番組
```sql
-- シリーズ番組
INSERT INTO programs (title, description, is_series) VALUES
('鬼滅の刃', '鬼と戦う剣士の物語', 1),
('サッカー名勝負集', '歴史に残る名試合を振り返る', 1);


-- 単発番組
INSERT INTO programs (title, description, is_series) VALUES
('今夜のニュース', '本日の主要ニュースをお届け', 0);
```

## 番組とジャンル
```sql
-- 鬼滅の刃
INSERT INTO program_genres VALUES
(1, 1), -- アニメ
(1, 3); -- アクション


-- サッカー名勝負集
INSERT INTO program_genres VALUES
(2, 4); -- スポーツ


-- 今夜のニュース
INSERT INTO program_genres VALUES
(3, 2); -- ドラマ（便宜上）
```

## シーズン
```sql
-- 鬼滅の刃 シーズン1
INSERT INTO seasons (program_id, season_number) VALUES
(1, 1);


-- サッカー名勝負集 シーズン1
INSERT INTO seasons (program_id, season_number) VALUES
(2, 1);
```

## エピソード
```sql
-- 鬼滅の刃 エピソード
INSERT INTO episodes
(program_id, season_id, episode_number, title, description, duration_seconds, published_at)
VALUES
(1, 1, 1, '残酷', '第1話', 1500, '2020-04-01'),
(1, 1, 2, '育手・鱗滝左近次', '第2話', 1500, '2020-04-08');


-- サッカー名勝負集
INSERT INTO episodes
(program_id, season_id, episode_number, title, description, duration_seconds, published_at)
VALUES
(2, 2, 1, 'ワールドカップ決勝', '伝説の決勝戦', 3600, '2018-07-16');


-- 単発番組（シーズン・話数なし）
INSERT INTO episodes
(program_id, season_id, episode_number, title, description, duration_seconds, published_at)
VALUES
(3, NULL, NULL, '2024年1月1日号', '元日のニュース', 1800, '2024-01-01');
```

## 番組枠
```sql
INSERT INTO program_slots (channel_id, start_time, end_time) VALUES
(2, '2024-01-01 20:00', '2024-01-01 20:30'), -- アニメ
(1, '2024-01-01 21:00', '2024-01-01 21:30'), -- ドラマ
(3, '2024-01-02 19:00', '2024-01-02 20:00'); -- スポーツ
```

## 放送
```sql
INSERT INTO broadcasts (program_slot_id, episode_id) VALUES
(1, 1), -- 鬼滅の刃 第1話（アニメ）
(2, 1), -- 鬼滅の刃 第1話（ドラマ枠で再放送）
(3, 3); -- サッカー名勝負集
```

## 視聴数-KPIデータ
```sql
INSERT INTO episode_views (broadcast_id, view_count) VALUES
(1, 120000),
(2, 45000),
(3, 98000);
```
