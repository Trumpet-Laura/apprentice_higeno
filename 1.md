# データベースの構築
初めにデータベースの構築をします。  
MySQL等のDBMSにログインし、次のコードを書きます。
```sql
create database internet_tv;
```
次に使用するデータベースを選択します。
```sql
use internet_tv;
```

# テーブルの構築
ステップ1で設計したテーブルを依存関係の順番で作成していきます。
## チャンネルテーブル
```sql
CREATE TABLE channels (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(100) NOT NULL
);
```

## 番組テーブル
```sql
CREATE TABLE programs (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
title VARCHAR(255) NOT NULL,
description TEXT,
is_series BOOLEAN NOT NULL DEFAULT 0
);
```

## ジャンルテーブル
```sql
CREATE TABLE genres (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(100) NOT NULL UNIQUE
);
```

## 番組とジャンルの中間テーブル
```sql
CREATE TABLE program_genres (
program_id BIGINT NOT NULL,
genre_id BIGINT NOT NULL,
PRIMARY KEY (program_id, genre_id),
FOREIGN KEY (program_id) REFERENCES programs(id),
FOREIGN KEY (genre_id) REFERENCES genres(id)
);
```

## シーズンテーブル
```sql
CREATE TABLE seasons (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_id BIGINT NOT NULL,
season_number INT NOT NULL,
UNIQUE (program_id, season_number),
FOREIGN KEY (program_id) REFERENCES programs(id)
);
```

## エピソードテーブル
```sql
CREATE TABLE episodes (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_id BIGINT NOT NULL,
season_id BIGINT,
episode_number INT,
title VARCHAR(255) NOT NULL,
description TEXT,
duration_seconds INT NOT NULL,
published_at DATETIME NOT NULL,
FOREIGN KEY (program_id) REFERENCES programs(id),
FOREIGN KEY (season_id) REFERENCES seasons(id)
);
```

## 番組枠テーブル
```sql
CREATE TABLE program_slots (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
channel_id BIGINT NOT NULL,
start_time DATETIME NOT NULL,
end_time DATETIME NOT NULL,
FOREIGN KEY (channel_id) REFERENCES channels(id)
);
```

## 放送テーブル（番組枠 × エピソード）
```sql
CREATE TABLE broadcasts (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
program_slot_id BIGINT NOT NULL,
episode_id BIGINT NOT NULL,
FOREIGN KEY (program_slot_id) REFERENCES program_slots(id),
FOREIGN KEY (episode_id) REFERENCES episodes(id)
);
```

## 視聴数-KPIテーブル
```sql
CREATE TABLE episode_views (
broadcast_id BIGINT PRIMARY KEY,
view_count BIGINT NOT NULL,
FOREIGN KEY (broadcast_id) REFERENCES broadcasts(id)
);
```
# サンプルデータ
サンプルデータを投入します。
## チャンネル
```sql
INSERT INTO channels (id, name) VALUES
(1, 'ドラマ1'),
(2, 'ドラマ2'),
(3, 'アニメ1'),
(4, 'アニメ2'),
(5, 'スポーツ');
```

## ジャンル
```sql
INSERT INTO genres (id, name) VALUES
(1, 'ドラマ'),
(2, 'アニメ'),
(3, 'スポーツ');
```

## 番組
```sql
INSERT INTO programs (id, title, description, is_series) VALUES
(1, '鬼滅の刃', '鬼と戦う剣士の物語', 1),
(2, '半沢直樹', '銀行員の逆転劇', 1),
(3, 'サッカー名勝負集', '歴史的名試合', 1);
```

## 番組とジャンル
```sql
INSERT INTO program_genres VALUES
(1, 2),
(2, 1),
(3, 3);
```

## シーズン
```sql
INSERT INTO seasons (id, program_id, season_number) VALUES
(1, 1, 1),
(2, 2, 1),
(3, 3, 1);
```

## エピソード
```sql
INSERT INTO episodes VALUES
(1, 1, 1, 1, '残酷', '第1話', 1500, '2024-01-01'),
(2, 1, 1, 2, '育手・鱗滝左近次', '第2話', 1500, '2024-01-02'),
(3, 2, 2, 1, '第1話', '半沢直樹第1話', 2700, '2024-01-01'),
(4, 3, 3, 1, 'W杯決勝', '名勝負', 3600, '2024-01-03');
```

## 番組枠
```sql
INSERT INTO program_slots VALUES
(1, 2, CURDATE() + INTERVAL 20 HOUR, CURDATE() + INTERVAL 20 HOUR + INTERVAL 30 MINUTE),
(2, 1, CURDATE() + INTERVAL 21 HOUR, CURDATE() + INTERVAL 21 HOUR + INTERVAL 45 MINUTE),
(3, 3, CURDATE() - INTERVAL 3 DAY, CURDATE() - INTERVAL 3 DAY + INTERVAL 1 HOUR);
```

## 放送
```sql
INSERT INTO broadcasts VALUES
(1, 1, 1),
(2, 2, 2),
(3, 3, 3),
(4, 3, 4);
```

## 視聴数-KPIデータ
```sql
INSERT INTO episode_views VALUES
(1, 120000),
(2, 80000),
(3, 150000),
(4, 90000);
```

